"use strict";(self.webpackChunkabp_zero_template=self.webpackChunkabp_zero_template||[]).push([[68592],{78812:(v,M,o)=>{o.d(M,{Y:()=>f});var e=o(99468);let f=(()=>{class h{constructor(){}isEditionFree(T){return!(T.dailyPrice||T.weeklyPrice||T.monthlyPrice||T.annualPrice)}static#e=this.\u0275fac=function(P){return new(P||h)};static#t=this.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})()},39387:(v,M,o)=>{o.d(M,{y:()=>O});var e=o(41840),f=o(44328),h=o(75857),l=o(66232),T=o(78853),P=o(43136),t=o(99468),E=o(78164),D=o(98833),u=o(96814),m=o(56223),N=o(85219),n=o(91396);function i(C,U){if(1&C){const a=t.EpF();t.TgZ(0,"input",5),t.NdJ("ngModelChange",function(d){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.value=d)})("change",function(){t.CHM(a);const d=t.oxw().$implicit,p=t.oxw();return t.KtG(p.onInputChange(d))}),t.qZA()}if(2&C){const a=t.oxw().$implicit;t.s9C("type","NUMERIC"===a.data.inputType.validator.name?"number":"text"),t.Q6J("ngModel",a.value),t.uIk("name",a.data.name)}}function s(C,U){if(1&C&&(t.TgZ(0,"option",8),t._uU(1),t.qZA()),2&C){const a=U.$implicit;t.Q6J("value",a.value),t.xp6(1),t.hij(" ",a.displayText," ")}}function c(C,U){if(1&C){const a=t.EpF();t.TgZ(0,"select",6),t.NdJ("ngModelChange",function(d){t.CHM(a);const p=t.oxw().$implicit;return t.KtG(p.value=d)})("change",function(){t.CHM(a);const d=t.oxw().$implicit,p=t.oxw();return t.KtG(p.onDropdownChange(d))}),t.YNc(1,s,2,2,"option",7),t.qZA()}if(2&C){const a=t.oxw().$implicit;t.Q6J("ngModel",a.value),t.xp6(1),t.Q6J("ngForOf",a.data.inputType.itemSource.items)}}function _(C,U){if(1&C&&(t.TgZ(0,"span",2),t._uU(1),t.qZA(),t.YNc(2,i,1,3,"input",3),t.YNc(3,c,2,2,"select",4)),2&C){const a=U.$implicit;t.xp6(1),t.Oqu(a.label),t.xp6(1),t.Q6J("ngIf","SINGLE_LINE_STRING"===a.data.inputType.name),t.xp6(1),t.Q6J("ngIf","COMBOBOX"===a.data.inputType.name)}}let O=(()=>{class C extends e.c{constructor(a,r,d){super(d),this._arrayToTreeConverterService=a,this._treeDataHelperService=r,this.selectedFeatures=[]}set editData(a){this._editData=a,this.setTreeData(a.features),this.setSelectedNodes(a)}setTreeData(a){this.treeData=this._arrayToTreeConverterService.createTree(a,"parentName","name",null,"children",[{target:"label",source:"displayName"},{target:"expandedIcon",value:"fa fa-folder-open text-warning"},{target:"collapsedIcon",value:"fa fa-folder text-warning"},{target:"expanded",value:!0},{target:"selectable",targetFunction:r=>"CHECKBOX"===r.inputType.name}])}setSelectedNodes(a){this.selectedFeatures=[],(0,h.Z)(a.features,r=>{let d=(0,l.Z)(a.featureValues,{name:r.name});if(d&&1===d.length){let p=d[0];this.setSelectedNode(p.name,p.value)}else this.setSelectedNode(r.name,r.defaultValue)})}setSelectedNode(a,r){let d;"true"===r?(d=this._treeDataHelperService.findNode(this.treeData,{data:{name:a}}),this.selectedFeatures.push(d)):r&&"false"!==r&&(d=this._treeDataHelperService.findNode(this.treeData,{data:{name:a}}),d.value=r,this.selectedFeatures.push(d))}getGrantedFeatures(){if(!this._editData.features)return[];let a=[];for(let r=0;r<this._editData.features.length;r++){let d=new f.O46;d.name=this._editData.features[r].name,d.value=this.getFeatureValueByName(d.name),a.push(d)}return a}onDropdownChange(a){a.value&&(a.selected=!0)}onInputChange(a){a.value&&(a.selected=!0)}findFeatureByName(a){const d=(0,T.Z)(this._editData.features,p=>p.name===a);return d||abp.log.warn("Could not find a feature by name: "+a),d}findFeatureValueByName(a){const d=this.findFeatureByName(a);if(!d)return"";const p=(0,T.Z)(this._editData.featureValues,g=>g.name===a);return p?p.value:d.defaultValue}isFeatureValueValid(a,r){const p=this.findFeatureByName(a);if(!p||!p.inputType||!p.inputType.validator)return!0;const g=p.inputType.validator;if("STRING"===g.name){if(null==r)return g.attributes.AllowNull;if("string"!=typeof r||g.attributes.MinLength>0&&r.length<g.attributes.MinLength||g.attributes.MaxLength>0&&r.length>g.attributes.MaxLength)return!1;if(g.attributes.RegularExpression)return new RegExp(g.attributes.RegularExpression).test(r)}else if("NUMERIC"===g.name){const S=parseInt(r);if(isNaN(S)||g.attributes.MinValue>S)return!1;const y=g.attributes.MaxValue;if(y>0&&S>y)return!1}return!0}areAllValuesValid(){let a=!0;return(0,h.Z)(this._editData.features,r=>{let d=this.getFeatureValueByName(r.name);this.isFeatureValueValid(r.name,d)||(a=!1)}),a}setFeatureValueByName(a,r){const d=(0,T.Z)(this._editData.featureValues,p=>p.name===a);d&&(d.value=r)}isFeatureSelected(a){let r=(0,l.Z)(this.selectedFeatures,{data:{name:a}});return r&&1===r.length}getFeatureValueByName(a){let r=this._treeDataHelperService.findNode(this.treeData,{data:{name:a}});return r?r.value?r.value:this.isFeatureSelected(a)?"true":"false":null}isFeatureEnabled(a){return"true"===this.findFeatureValueByName(a).toLowerCase()}nodeSelect(a){let r=this._treeDataHelperService.findParent(this.treeData,{data:{name:a.node.data.name}});for(;null!=r;)(0,T.Z)(this.selectedFeatures,p=>p.data.name===r.data.name)||this.selectedFeatures.push(r),r=this._treeDataHelperService.findParent(this.treeData,{data:{name:r.data.name}})}onNodeUnselect(a){let r=this._treeDataHelperService.findChildren(this.treeData,{data:{name:a.node.data.name}});r.push(a.node.data.name),(0,P.Z)(this.selectedFeatures,d=>-1!==r.indexOf(d.data.name))}static#e=this.\u0275fac=function(r){return new(r||C)(t.Y36(E.V),t.Y36(D.j),t.Y36(t.zs3))};static#t=this.\u0275cmp=t.Xpm({type:C,selectors:[["feature-tree"]],features:[t.qOj],decls:2,vars:3,consts:[["selectionMode","checkbox",3,"value","selection","propagateSelectionUp","selectionChange","onNodeSelect","onNodeUnselect"],["pTemplate","default"],[2,"margin-right","5px"],[3,"type","ngModel","ngModelChange","change",4,"ngIf"],[3,"ngModel","ngModelChange","change",4,"ngIf"],[3,"type","ngModel","ngModelChange","change"],[3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(r,d){1&r&&(t.TgZ(0,"p-tree",0),t.NdJ("selectionChange",function(g){return d.selectedFeatures=g})("onNodeSelect",function(g){return d.nodeSelect(g)})("onNodeUnselect",function(g){return d.onNodeUnselect(g)}),t.YNc(1,_,4,3,"ng-template",1),t.qZA()),2&r&&t.Q6J("value",d.treeData)("selection",d.selectedFeatures)("propagateSelectionUp",!1)},dependencies:[u.sg,u.O5,m.YN,m.Kr,m.Fj,m.EJ,m.JJ,m.On,N.jx,n.mp],styles:[".feature-tree-textbox[_ngcontent-%COMP%]{max-width:100px;margin:1px 1px 1px 5px}.feature-tree-textbox.feature-tree-textbox-invalid[_ngcontent-%COMP%]{background:#f00;color:#fff}"]})}return C})()},87672:(v,M,o)=>{o.d(M,{x:()=>u});var e=o(41840),f=o(75857),h=o(43136),l=o(99468),T=o(78164),P=o(98833),t=o(56223),E=o(91396),D=o(3291);let u=(()=>{class m extends e.c{constructor(n,i,s){super(s),this._arrayToTreeConverterService=n,this._treeDataHelperService=i,this.cascadeSelectEnabled=!0,this.selectedOus=[],this.filter=""}set data(n){this.setTreeData(n.allOrganizationUnits),this.setSelectedNodes(n.selectedOrganizationUnits),this._allOrganizationUnits=n.allOrganizationUnits,this._selectedOrganizationUnits=n.selectedOrganizationUnits}setTreeData(n){this.treeData=this._arrayToTreeConverterService.createTree(n,"parentId","id",null,"children",[{target:"label",source:"displayName"},{target:"expandedIcon",value:"fa fa-folder-open text-warning"},{target:"collapsedIcon",value:"fa fa-folder text-warning"},{target:"expanded",value:!0}])}setSelectedNodes(n){this.selectedOus=[],(0,f.Z)(n,i=>{let s=this._treeDataHelperService.findNode(this.treeData,{data:{code:i}});s&&this.selectedOus.push(s)})}getSelectedOrganizationIds(){if(!this.selectedOus)return[];let n=[];return(0,f.Z)(this.selectedOus,i=>{n.push(i.data.id)}),n}getSelectedOrganizations(){if(!this.selectedOus)return[];let n=[];return(0,f.Z)(this.selectedOus,i=>{n.push({displayName:i.data.displayName,id:i.data.id})}),n}filterOrganizationUnit(n,i){(0,f.Z)(n,s=>{s.styleClass=s.data.displayName.toLowerCase().indexOf(i.toLowerCase())>=0?this.showParentNodes(s):"hidden-tree-node",s.children&&this.filterOrganizationUnit(s.children,i)})}showParentNodes(n){n.parent&&(n.parent.styleClass="",this.showParentNodes(n.parent))}filterOrganizationUnits(n){this.filterOrganizationUnit(this.treeData,this.filter)}nodeSelect(n){if(!this.cascadeSelectEnabled)return;let i=this._treeDataHelperService.findParent(this.treeData,{data:{id:n.node.data.id}});for(;null!=i;)this.selectedOus.push(i),i=this._treeDataHelperService.findParent(this.treeData,{data:{id:i.data.id}})}onNodeUnselect(n){(0,h.Z)(this.selectedOus,i=>i.data.id==n.node.data.id)}static#e=this.\u0275fac=function(i){return new(i||m)(l.Y36(T.V),l.Y36(P.j),l.Y36(l.zs3))};static#t=this.\u0275cmp=l.Xpm({type:m,selectors:[["organization-unit-tree"]],inputs:{cascadeSelectEnabled:"cascadeSelectEnabled"},features:[l.qOj],decls:4,vars:8,consts:[[1,"form-group"],["id","OrganizationUnitsTreeFilter","type","text",1,"form-control",3,"ngModel","placeholder","input","ngModelChange"],["selectionMode","checkbox",3,"value","selection","propagateSelectionUp","propagateSelectionDown","selectionChange","onNodeSelect","onNodeUnselect"]],template:function(i,s){1&i&&(l.TgZ(0,"div",0)(1,"input",1),l.NdJ("input",function(_){return s.filterOrganizationUnits(_)})("ngModelChange",function(_){return s.filter=_}),l.ALo(2,"localize"),l.qZA()(),l.TgZ(3,"p-tree",2),l.NdJ("selectionChange",function(_){return s.selectedOus=_})("onNodeSelect",function(_){return s.nodeSelect(_)})("onNodeUnselect",function(_){return s.onNodeUnselect(_)}),l.qZA()),2&i&&(l.xp6(1),l.s9C("placeholder",l.lcZ(2,6,"SearchWithThreeDot")),l.Q6J("ngModel",s.filter),l.xp6(2),l.Q6J("value",s.treeData)("selection",s.selectedOus)("propagateSelectionUp",!1)("propagateSelectionDown",s.cascadeSelectEnabled))},dependencies:[t.Fj,t.JJ,t.On,E.mp,D.F],encapsulation:2})}return m})()},59170:(v,M,o)=>{o.d(M,{Z:()=>N});var e=o(99468),f=o(41840),h=o(44328),l=o(96814),T=o(24142),P=o(99824),t=o(3291);const E=["permissionTreeModal"],D=["permissionTree"];function u(n,i){if(1&n){const s=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(s);const _=e.oxw();return e.KtG(_.openPermissionTreeModal())}),e._uU(1),e.ALo(2,"localize"),e.qZA()}if(2&n){const s=e.oxw();e.xp6(1),e.AsE(" ",e.lcZ(2,2,"SelectPermissions")," (",s.NumberOfFilteredPermission,")\n")}}const m=function(){return{backdrop:"static"}};let N=(()=>{class n extends f.c{constructor(s,c){super(s),this._permissionService=c,this.onModalclose=new e.vpe,this.selectedPermissions=[],this.NumberOfFilteredPermission=0}ngOnInit(){this.loadAllPermissionsToFilterTree()}openPermissionTreeModal(){this.permissionTreeModal.show()}closePermissionTreeModal(){let s=this.getSelectedPermissions();this.NumberOfFilteredPermission=s.length,this.onModalclose.emit(s),this.permissionTreeModal.hide(),abp.notify.success(this.l("XCountPermissionFiltered",this.NumberOfFilteredPermission))}getSelectedPermissions(){return this.permissionTree?this.permissionTree.getGrantedPermissionNames().filter((c,_,O)=>_===O.findIndex(C=>C===c)):[]}loadAllPermissionsToFilterTree(){let s=[];this._permissionService.getAllPermissions().subscribe(c=>{c.items&&c.items.forEach(_=>{s.push(new h.h$({name:_.name,description:_.description,displayName:_.displayName,isGrantedByDefault:_.isGrantedByDefault,parentName:_.parentName}))}),this.permissionTree.editData={permissions:s,grantedPermissionNames:[]}})}static#e=this.\u0275fac=function(c){return new(c||n)(e.Y36(e.zs3),e.Y36(h.$zk))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["permission-tree-modal"]],viewQuery:function(c,_){if(1&c&&(e.Gf(E,7),e.Gf(D,5)),2&c){let O;e.iGM(O=e.CRH())&&(_.permissionTreeModal=O.first),e.iGM(O=e.CRH())&&(_.permissionTree=O.first)}},inputs:{dontAddOpenerButton:"dontAddOpenerButton",singleSelect:"singleSelect",disableCascade:"disableCascade"},outputs:{onModalclose:"onModalclose"},features:[e.qOj],decls:17,vars:12,consts:[["class","btn btn-secondary w-100",3,"click",4,"ngIf"],["appBsModal","","tabindex","-1","role","dialog","aria-labelledby","permissionTreeModal","aria-hidden","true",1,"modal","fade",3,"config"],["permissionTreeModal","bs-modal"],[1,"modal-dialog","modal-lg","permissionFilterTreeModal"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[3,"singleSelect","disableCascade"],["permissionTree",""],[1,"modal-footer"],["type","button",1,"btn","btn-primary","fw-bold",3,"click"],[1,"btn","btn-secondary","w-100",3,"click"]],template:function(c,_){1&c&&(e.YNc(0,u,3,4,"button",0),e.TgZ(1,"div",1,2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h4",6),e._uU(7),e.ALo(8,"localize"),e.qZA(),e.TgZ(9,"button",7),e.NdJ("click",function(){return _.closePermissionTreeModal()}),e.qZA()(),e.TgZ(10,"div",8),e._UZ(11,"permission-tree",9,10),e.qZA(),e.TgZ(13,"div",11)(14,"button",12),e.NdJ("click",function(){return _.closePermissionTreeModal()}),e._uU(15),e.ALo(16,"localize"),e.qZA()()()()()),2&c&&(e.Q6J("ngIf",!_.dontAddOpenerButton),e.xp6(1),e.Q6J("config",e.DdM(11,m)),e.xp6(6),e.hij(" ",e.lcZ(8,7,"SelectPermissions")," "),e.xp6(2),e.uIk("aria-label",_.l("Close")),e.xp6(2),e.Q6J("singleSelect",_.singleSelect)("disableCascade",_.disableCascade),e.xp6(4),e.hij(" ",e.lcZ(16,9,"Select")," "))},dependencies:[l.O5,T.Z,P.I,t.F],encapsulation:2})}return n})()},99824:(v,M,o)=>{o.d(M,{I:()=>u});var e=o(41840),f=o(75857),h=o(43136),l=o(99468),T=o(78164),P=o(98833),t=o(56223),E=o(91396),D=o(3291);let u=(()=>{class m extends e.c{constructor(n,i,s){super(s),this._arrayToTreeConverterService=n,this._treeDataHelperService=i,this.selectedPermissions=[],this.filter=""}set editData(n){this.setTreeData(n.permissions),this.setSelectedNodes(n.grantedPermissionNames)}setTreeData(n){this.treeData=this._arrayToTreeConverterService.createTree(n,"parentName","name",null,"children",[{target:"label",source:"displayName"},{target:"expandedIcon",value:"fa fa-folder-open text-warning"},{target:"collapsedIcon",value:"fa fa-folder text-warning"},{target:"expanded",value:!0}])}setSelectedNodes(n){this.selectedPermissions=[],(0,f.Z)(n,i=>{let s=this._treeDataHelperService.findNode(this.treeData,{data:{name:i}});s&&this.selectedPermissions.push(s)})}getGrantedPermissionNames(){if(!this.selectedPermissions||!this.selectedPermissions.length)return[];let n=[];for(let i=0;i<this.selectedPermissions.length;i++)n.push(this.selectedPermissions[i].data.name);return n}nodeSelect(n){if(this.singleSelect)return void(this.selectedPermissions=[n.node]);if(this.disableCascade)return;let i=this._treeDataHelperService.findParent(this.treeData,{data:{name:n.node.data.name}});for(;null!=i;)this.selectedPermissions.push(i),i=this._treeDataHelperService.findParent(this.treeData,{data:{name:i.data.name}})}onNodeUnselect(n){if(this.disableCascade)return;let i=this._treeDataHelperService.findChildren(this.treeData,{data:{name:n.node.data.name}});i.push(n.node.data.name),(0,h.Z)(this.selectedPermissions,s=>-1!==i.indexOf(s.data.name))}filterPermissions(n){this.filterPermission(this.treeData,this.filter)}filterPermission(n,i){(0,f.Z)(n,s=>{s.styleClass=s.data.displayName.toLowerCase().indexOf(i.toLowerCase())>=0?this.showParentNodes(s):"hidden-tree-node",s.children&&this.filterPermission(s.children,i)})}showParentNodes(n){n.parent&&(n.parent.styleClass="",this.showParentNodes(n.parent))}static#e=this.\u0275fac=function(i){return new(i||m)(l.Y36(T.V),l.Y36(P.j),l.Y36(l.zs3))};static#t=this.\u0275cmp=l.Xpm({type:m,selectors:[["permission-tree"]],inputs:{singleSelect:"singleSelect",disableCascade:"disableCascade"},features:[l.qOj],decls:4,vars:8,consts:[[1,"my-5"],["type","text",1,"form-control",3,"ngModel","placeholder","input","ngModelChange"],["selectionMode","checkbox",3,"value","selection","propagateSelectionUp","propagateSelectionDown","selectionChange","onNodeSelect","onNodeUnselect"]],template:function(i,s){1&i&&(l.TgZ(0,"div",0)(1,"input",1),l.NdJ("input",function(_){return s.filterPermissions(_)})("ngModelChange",function(_){return s.filter=_}),l.ALo(2,"localize"),l.qZA()(),l.TgZ(3,"p-tree",2),l.NdJ("selectionChange",function(_){return s.selectedPermissions=_})("onNodeSelect",function(_){return s.nodeSelect(_)})("onNodeUnselect",function(_){return s.onNodeUnselect(_)}),l.qZA()),2&i&&(l.xp6(1),l.s9C("placeholder",l.lcZ(2,6,"SearchWithThreeDot")),l.Q6J("ngModel",s.filter),l.xp6(2),l.Q6J("value",s.treeData)("selection",s.selectedPermissions)("propagateSelectionUp",!1)("propagateSelectionDown",!s.disableCascade))},dependencies:[t.Fj,t.JJ,t.On,E.mp,D.F],encapsulation:2})}return m})()},91344:(v,M,o)=>{o.d(M,{P:()=>D});var e=o(99468),f=o(96814),h=o(56223),l=o(3291);function T(u,m){1&u&&e._UZ(0,"i",7)}function P(u,m){1&u&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&u&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"Show")))}function t(u,m){1&u&&e._UZ(0,"i",8)}function E(u,m){1&u&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&u&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"Hide")))}let D=(()=>{class u{constructor(){this.dataChange=new e.vpe,this.isVisible=!1}toggleVisibility(){this.isVisible=!this.isVisible}onChange(){this.dataChange.emit(this.data)}static#e=this.\u0275fac=function(n){return new(n||u)};static#t=this.\u0275cmp=e.Xpm({type:u,selectors:[["password-input-with-show-button"]],inputs:{data:"data"},outputs:{dataChange:"dataChange"},decls:8,vars:6,consts:[[1,"input-group"],[1,"form-control",3,"ngModel","type","ngModelChange","change"],[1,"input-group-append"],["type","button",1,"btn","btn-primary",3,"click"],["class","far fa-eye text-white",4,"ngIf"],[4,"ngIf"],["class","far fa-eye-slash text-white",4,"ngIf"],[1,"far","fa-eye","text-white"],[1,"far","fa-eye-slash","text-white"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0)(1,"input",1),e.NdJ("ngModelChange",function(c){return i.data=c})("change",function(){return i.onChange()}),e.qZA(),e.TgZ(2,"div",2)(3,"button",3),e.NdJ("click",function(){return i.toggleVisibility()}),e.YNc(4,T,1,0,"i",4),e.YNc(5,P,3,3,"span",5),e.YNc(6,t,1,0,"i",6),e.YNc(7,E,3,3,"span",5),e.qZA()()()),2&n&&(e.xp6(1),e.Q6J("ngModel",i.data)("type",i.isVisible?"text":"password"),e.xp6(3),e.Q6J("ngIf",!i.isVisible),e.xp6(1),e.Q6J("ngIf",!i.isVisible),e.xp6(1),e.Q6J("ngIf",i.isVisible),e.xp6(1),e.Q6J("ngIf",i.isVisible))},dependencies:[f.O5,h.Fj,h.JJ,h.On,l.F],encapsulation:2})}return u})()},98155:(v,M,o)=>{o.d(M,{G:()=>h});var e=o(50387),f=o(99468);let h=(()=>{class l{constructor(P){this.permission=P.get(e.qT)}transform(P){if(!P)return!1;for(const t of P)if(this.permission.isGranted(t))return!0;return!1}static#e=this.\u0275fac=function(t){return new(t||l)(f.Y36(f.zs3,16))};static#t=this.\u0275pipe=f.Yjl({name:"permissionAny",type:l,pure:!0})}return l})()}}]);