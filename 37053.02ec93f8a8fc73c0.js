"use strict";(self.webpackChunkabp_zero_template=self.webpackChunkabp_zero_template||[]).push([[37053],{37053:(q,T,s)=>{s.r(T),s.d(T,{MassNotificationsModule:()=>Ne});var S=s(71902),z=s(92337),v=s(70916),b=s(41840),m=s(44328),A=s(47530),e=s(99468),O=s(58399),M=s(96814),d=s(56223),J=s(12051),C=s(53279),N=s(94901),L=s(81243),_=s(68027),Z=s(85219),U=s(51712),k=s(68989),w=s(64716),l=s(45513),r=s(42152),g=s(24142),f=s(32925),p=s(3291);const h=["userLookupTableModal"],x=["dataTable"],I=["paginator"];function P(n,u){if(1&n&&(e.TgZ(0,"tr")(1,"th",31),e._UZ(2,"p-tableHeaderCheckbox"),e.qZA(),e.TgZ(3,"th",32),e._uU(4),e._UZ(5,"p-sortIcon",33),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.hij(" ",t.l("Name")," ")}}function H(n,u){if(1&n&&(e.TgZ(0,"tr")(1,"td",31)(2,"p-tableCheckbox",34),e.NdJ("click",function(i){return i.stopPropagation()}),e.qZA()(),e.TgZ(3,"td",35)(4,"span",36),e._uU(5),e.qZA(),e._uU(6),e.qZA()()),2&n){const t=u.$implicit,i=e.oxw();e.xp6(2),e.Q6J("value",t),e.xp6(3),e.Oqu(i.l("Name")),e.xp6(1),e.hij(" ",t.displayName," ")}}function D(n,u){if(1&n&&(e.TgZ(0,"div",37),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" ",t.l("NoData")," ")}}const R=function(){return{backdrop:"static"}},Q=function(){return{"min-width":"25rem"}};let G=(()=>{class n extends b.c{constructor(t,i){super(t),this._notificationServiceProxy=i,this.filterText="",this.modalSave=new e.vpe,this.active=!1,this.saving=!1}show(){this.active=!0,this.paginator.rows=5,this.getAll(),this.modal.show()}getAll(t){this.active&&(this.primengTableHelper.shouldResetPaging(t)&&(this.paginator.changePage(0),this.primengTableHelper.records&&this.primengTableHelper.records.length>0)||(this.primengTableHelper.showLoadingIndicator(),this._notificationServiceProxy.getAllUserForLookupTable(this.filterText,this.primengTableHelper.getSorting(this.dataTable),this.primengTableHelper.getSkipCount(this.paginator,t),this.primengTableHelper.getMaxResultCount(this.paginator,t)).subscribe(i=>{this.primengTableHelper.totalRecordsCount=i.totalCount,this.primengTableHelper.records=i.items,this.primengTableHelper.hideLoadingIndicator()})))}reloadPage(){this.paginator.changePage(this.paginator.getPage())}save(){this.active=!1,this.modal.hide(),this.modalSave.emit(this.selectedUsers),this.selectedUsers=[]}close(){this.active=!1,this.modal.hide(),this.selectedUsers=[]}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(e.zs3),e.Y36(m.IMf))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["user-lookup-table-modal"]],viewQuery:function(i,a){if(1&i&&(e.Gf(h,7),e.Gf(x,7),e.Gf(I,7)),2&i){let o;e.iGM(o=e.CRH())&&(a.modal=o.first),e.iGM(o=e.CRH())&&(a.dataTable=o.first),e.iGM(o=e.CRH())&&(a.paginator=o.first)}},outputs:{modalSave:"modalSave"},features:[e.qOj],decls:40,vars:33,consts:[["appBsModal","","tabindex","-1","role","dialog","aria-labelledby","userLookupTableModal","aria-hidden","true",1,"modal","fade",3,"config"],["userLookupTableModal","bs-modal"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"disabled","click"],[1,"card","card-custom","gutter-b"],[1,"card-body"],["autocomplete","off",1,"form"],[1,"row","align-items-center","mb-4"],[1,"col-xl-12"],[1,"my-3"],[1,"input-group"],["name","filterText","autoFocus","","type","text",1,"form-control","m-input",3,"ngModel","placeholder","ngModelChange"],["type","submit",1,"btn","btn-primary",3,"click"],[1,"flaticon-search-1"],[1,"row","align-items-center"],[1,"primeng-datatable-container",3,"busyIf"],["ScrollWidth","100%","selectionMode","multiple",3,"value","rows","paginator","lazy","scrollable","tableStyle","selection","onLazyLoad","selectionChange"],["dataTable",""],["pTemplate","header"],["pTemplate","body"],["class","primeng-no-data",4,"ngIf"],[1,"primeng-paging-container"],["styleClass","user-lookup-table-paginator",3,"rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","currentPageReportTemplate","onPageChange"],["paginator",""],[1,"modal-footer"],["type","button",1,"btn","btn-light-primary","font-weight-bold",3,"disabled","click"],[1,"btn","btn-primary","font-weight-bold",3,"buttonBusy","busyText","click"],[1,"fa","fa-save"],[2,"width","38px"],["pSortableColumn","displayName",2,"width","150px"],["field","displayName"],[3,"value","click"],[2,"width","150px"],[1,"p-column-title"],[1,"primeng-no-data"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0,1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5)(6,"span"),e._uU(7),e.qZA()(),e.TgZ(8,"button",6),e.NdJ("click",function(){return a.close()}),e.qZA()(),e.TgZ(9,"div",7)(10,"div",8)(11,"form",9)(12,"div")(13,"div",10)(14,"div",11)(15,"div",12)(16,"div",13)(17,"input",14),e.NdJ("ngModelChange",function(c){return a.filterText=c}),e.qZA(),e.TgZ(18,"button",15),e.NdJ("click",function(){return a.getAll()}),e._UZ(19,"i",16),e.qZA()()()()()()(),e.TgZ(20,"div",17)(21,"div",18)(22,"p-table",19,20),e.NdJ("onLazyLoad",function(c){return a.getAll(c)})("selectionChange",function(c){return a.selectedUsers=c}),e.YNc(24,P,6,1,"ng-template",21),e.YNc(25,H,7,3,"ng-template",22),e.qZA(),e.YNc(26,D,2,1,"div",23),e.TgZ(27,"div",24)(28,"p-paginator",25,26),e.NdJ("onPageChange",function(c){return a.getAll(c)}),e.ALo(30,"localize"),e.qZA()()()()()(),e.TgZ(31,"div",27)(32,"button",28),e.NdJ("click",function(){return a.close()}),e._uU(33),e.ALo(34,"localize"),e.qZA(),e.TgZ(35,"button",29),e.NdJ("click",function(){return a.save()}),e._UZ(36,"i",30),e.TgZ(37,"span"),e._uU(38),e.ALo(39,"localize"),e.qZA()()()()()()),2&i&&(e.Q6J("config",e.DdM(31,R)),e.xp6(7),e.Oqu(a.l("SearchUser")),e.xp6(1),e.Q6J("disabled",a.saving),e.xp6(9),e.Q6J("ngModel",a.filterText)("placeholder",a.l("SearchWithThreeDot")),e.xp6(4),e.Q6J("busyIf",a.primengTableHelper.isLoading),e.xp6(1),e.s9C("rows",a.primengTableHelper.defaultRecordsCountPerPage),e.Q6J("value",a.primengTableHelper.records)("paginator",!1)("lazy",!0)("scrollable",!0)("tableStyle",e.DdM(32,Q))("selection",a.selectedUsers),e.xp6(4),e.Q6J("ngIf",0==a.primengTableHelper.totalRecordsCount),e.xp6(2),e.Q6J("rows",a.primengTableHelper.defaultRecordsCountPerPage)("totalRecords",a.primengTableHelper.totalRecordsCount)("rowsPerPageOptions",a.primengTableHelper.predefinedRecordsCountPerPage)("showCurrentPageReport",!0)("currentPageReportTemplate",e.xi3(30,24,"TotalRecordsCount",a.primengTableHelper.totalRecordsCount)),e.xp6(4),e.Q6J("disabled",a.saving),e.xp6(1),e.hij(" ",e.lcZ(34,27,"Cancel")," "),e.xp6(2),e.Q6J("buttonBusy",a.saving)("busyText",a.l("SavingWithThreeDot")),e.xp6(3),e.Oqu(e.lcZ(39,29,"Save")))},dependencies:[M.O5,d._Y,d.Fj,d.JJ,d.JL,d.On,d.F,l.L,f.h,N.U,_.iA,Z.jx,_.lQ,_.fz,_.UA,_.Mo,U.D,g.Z,p.F],encapsulation:2})}return n})();var y=s(75857),F=s(43136),j=s(78164),Y=s(98833),E=s(91396);let B=(()=>{class n extends b.c{constructor(t,i,a){super(a),this._arrayToTreeConverterService=t,this._treeDataHelperService=i,this.cascadeSelectEnabled=!0,this.selectedOus=[],this.filter=""}set data(t){this.setTreeData(t.allOrganizationUnits),this.setSelectedNodes(t.selectedOrganizationUnits),this._allOrganizationUnits=t.allOrganizationUnits,this._selectedOrganizationUnits=t.selectedOrganizationUnits}setTreeData(t){this.treeData=this._arrayToTreeConverterService.createTree(t,"parentId","id",null,"children",[{target:"label",source:"displayName"},{target:"expandedIcon",value:"fa fa-folder-open text-warning"},{target:"collapsedIcon",value:"fa fa-folder text-warning"},{target:"expanded",value:!0}])}setSelectedNodes(t){this.selectedOus=[],(0,y.Z)(t,i=>{let a=this._treeDataHelperService.findNode(this.treeData,{data:{code:i}});a&&this.selectedOus.push(a)})}getSelectedOrganizationIds(){if(!this.selectedOus)return[];let t=[];return(0,y.Z)(this.selectedOus,i=>{t.push(i.data.id)}),t}getSelectedOrganizations(){if(!this.selectedOus)return[];let t=[];return(0,y.Z)(this.selectedOus,i=>{t.push({displayName:i.data.displayName,id:i.data.id})}),t}filterOrganizationUnit(t,i){(0,y.Z)(t,a=>{a.styleClass=a.data.displayName.toLowerCase().indexOf(i.toLowerCase())>=0?this.showParentNodes(a):"hidden-tree-node",a.children&&this.filterOrganizationUnit(a.children,i)})}showParentNodes(t){t.parent&&(t.parent.styleClass="",this.showParentNodes(t.parent))}filterOrganizationUnits(t){this.filterOrganizationUnit(this.treeData,this.filter)}nodeSelect(t){if(!this.cascadeSelectEnabled)return;let i=this._treeDataHelperService.findParent(this.treeData,{data:{id:t.node.data.id}});for(;null!=i;)this.selectedOus.push(i),i=this._treeDataHelperService.findParent(this.treeData,{data:{id:i.data.id}})}onNodeUnselect(t){(0,F.Z)(this.selectedOus,i=>i.data.id==t.node.data.id)}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(j.V),e.Y36(Y.j),e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["organization-unit-tree"]],inputs:{cascadeSelectEnabled:"cascadeSelectEnabled"},features:[e.qOj],decls:4,vars:8,consts:[[1,"form-group"],["id","OrganizationUnitsTreeFilter","type","text",1,"form-control",3,"ngModel","placeholder","input","ngModelChange"],["selectionMode","checkbox",3,"value","selection","propagateSelectionUp","propagateSelectionDown","selectionChange","onNodeSelect","onNodeUnselect"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0)(1,"input",1),e.NdJ("input",function(c){return a.filterOrganizationUnits(c)})("ngModelChange",function(c){return a.filter=c}),e.ALo(2,"localize"),e.qZA()(),e.TgZ(3,"p-tree",2),e.NdJ("selectionChange",function(c){return a.selectedOus=c})("onNodeSelect",function(c){return a.nodeSelect(c)})("onNodeUnselect",function(c){return a.onNodeUnselect(c)}),e.qZA()),2&i&&(e.xp6(1),e.s9C("placeholder",e.lcZ(2,6,"SearchWithThreeDot")),e.Q6J("ngModel",a.filter),e.xp6(2),e.Q6J("value",a.treeData)("selection",a.selectedOus)("propagateSelectionUp",!1)("propagateSelectionDown",a.cascadeSelectEnabled))},dependencies:[d.Fj,d.JJ,d.On,E.mp,p.F],encapsulation:2})}return n})();const K=["organizationUnitLookupTableModal"],W=["organizationUnitTree"],$=function(){return{backdrop:"static"}};let X=(()=>{class n extends b.c{constructor(t,i){super(t),this._organizationUnitServiceProxy=i,this.filterText="",this.modalSave=new e.vpe,this.active=!1,this.saving=!1}show(){this.active=!0,this.modal.show(),this.getOrganizationUnits()}getOrganizationUnits(){this._organizationUnitServiceProxy.getAll().subscribe(t=>{this.allOrganizationUnits=t})}onShown(){this.organizationUnitTree.data={allOrganizationUnits:this.allOrganizationUnits,selectedOrganizationUnits:[]}}save(){this.active=!1,this.modal.hide(),this.modalSave.emit(this.organizationUnitTree.getSelectedOrganizations())}close(){this.active=!1,this.modal.hide()}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(e.zs3),e.Y36(m.OAl))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["organization-unit-lookup-table-modal"]],viewQuery:function(i,a){if(1&i&&(e.Gf(K,7),e.Gf(W,5)),2&i){let o;e.iGM(o=e.CRH())&&(a.modal=o.first),e.iGM(o=e.CRH())&&(a.organizationUnitTree=o.first)}},outputs:{modalSave:"modalSave"},features:[e.qOj],decls:23,vars:14,consts:[["appBsModal","","tabindex","-1","role","dialog","aria-labelledby","organizationUnitLookupTableModal","aria-hidden","true",1,"modal","fade",3,"config","onShown"],["organizationUnitLookupTableModal","bs-modal"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"disabled","click"],[1,"card","card-custom","gutter-b"],[1,"card-body"],[1,"row","align-items-center"],[3,"cascadeSelectEnabled"],["organizationUnitTree",""],[1,"modal-footer"],["type","button",1,"btn","btn-light-primary","font-weight-bold",3,"disabled","click"],[1,"btn","btn-primary","font-weight-bold",3,"buttonBusy","busyText","click"],[1,"fa","fa-save"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0,1),e.NdJ("onShown",function(){return a.onShown()}),e.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5)(6,"span"),e._uU(7),e.qZA()(),e.TgZ(8,"button",6),e.NdJ("click",function(){return a.close()}),e.qZA()(),e.TgZ(9,"div",7)(10,"div",8)(11,"div",9),e._UZ(12,"organization-unit-tree",10,11),e.qZA()()(),e.TgZ(14,"div",12)(15,"button",13),e.NdJ("click",function(){return a.close()}),e._uU(16),e.ALo(17,"localize"),e.qZA(),e.TgZ(18,"button",14),e.NdJ("click",function(){return a.save()}),e._UZ(19,"i",15),e.TgZ(20,"span"),e._uU(21),e.ALo(22,"localize"),e.qZA()()()()()()),2&i&&(e.Q6J("config",e.DdM(13,$)),e.xp6(7),e.Oqu(a.l("SearchOrganizationUnit")),e.xp6(1),e.Q6J("disabled",a.saving),e.xp6(4),e.Q6J("cascadeSelectEnabled",!1),e.xp6(3),e.Q6J("disabled",a.saving),e.xp6(1),e.hij(" ",e.lcZ(17,9,"Cancel")," "),e.xp6(2),e.Q6J("buttonBusy",a.saving)("busyText",a.l("SavingWithThreeDot")),e.xp6(3),e.Oqu(e.lcZ(22,11,"Save")))},dependencies:[l.L,g.Z,B,p.F],encapsulation:2})}return n})();const V=["createOrEditModal"],ee=["userLookupTableModalComponent"],te=["organizationUnitLookupTableModalComponent"];function ae(n,u){if(1&n&&(e.TgZ(0,"option",44),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&n){const t=u.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(e.lcZ(2,2,t))}}function ie(n,u){1&n&&(e.TgZ(0,"small",45),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"NotificationTargetNotifierSmsLengthInfo")," "))}function oe(n,u){if(1&n){const t=e.EpF();e.TgZ(0,"form",8,9),e.NdJ("ngSubmit",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.save())}),e.TgZ(2,"div",10)(3,"h4",11)(4,"span"),e._uU(5),e.qZA()(),e.TgZ(6,"button",12),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.close())}),e.qZA()(),e.TgZ(7,"div",13)(8,"div",14)(9,"label",15),e._uU(10),e.qZA(),e.TgZ(11,"div",16)(12,"input",17),e.NdJ("ngModelChange",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.userNames=a)}),e.qZA(),e.TgZ(13,"button",18),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.openSelectUserModal())}),e._UZ(14,"i",19),e._uU(15),e.qZA(),e.TgZ(16,"button",20),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.setUserIdNull())}),e._UZ(17,"i",21),e.qZA()()(),e.TgZ(18,"div",14)(19,"label",22),e._uU(20),e.qZA(),e.TgZ(21,"div",16)(22,"input",23),e.NdJ("ngModelChange",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.organizationUnitDisplayNames=a)}),e.qZA(),e.TgZ(23,"button",18),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.openSelectOrganizationUnitModal())}),e._UZ(24,"i",19),e._uU(25),e.qZA(),e.TgZ(26,"button",20),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.setOrganizationUnitIdNull())}),e._UZ(27,"i",21),e.qZA()()(),e.TgZ(28,"div",14)(29,"label",24),e._uU(30),e.qZA(),e.TgZ(31,"select",25,26),e.NdJ("ngModelChange",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.createMassNotificationInput.severity=a)}),e.TgZ(33,"option",27),e._uU(34),e.qZA(),e.TgZ(35,"option",28),e._uU(36),e.qZA(),e.TgZ(37,"option",29),e._uU(38),e.qZA(),e.TgZ(39,"option",30),e._uU(40),e.qZA(),e.TgZ(41,"option",31),e._uU(42),e.qZA()(),e._UZ(43,"validation-messages",32),e.qZA(),e.TgZ(44,"div",14)(45,"label",33),e._uU(46),e.qZA(),e.TgZ(47,"select",34,26),e.NdJ("ngModelChange",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.createMassNotificationInput.targetNotifiers=a)})("change",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.onTargetNotifiersChanged())}),e._uU(49," > "),e.YNc(50,ae,3,4,"option",35),e.qZA(),e.YNc(51,ie,3,3,"small",36),e.qZA(),e.TgZ(52,"div",14)(53,"label",37),e._uU(54),e.qZA(),e.TgZ(55,"textarea",38,39),e.NdJ("ngModelChange",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.createMassNotificationInput.message=a)}),e.qZA(),e._UZ(57,"validation-messages",32),e.qZA()(),e.TgZ(58,"div",40)(59,"button",41),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.close())}),e._uU(60),e.qZA(),e.TgZ(61,"button",42),e._UZ(62,"i",43),e.TgZ(63,"span"),e._uU(64),e.qZA()()()()}if(2&n){const t=e.MAs(1),i=e.MAs(32),a=e.MAs(56),o=e.oxw();e.xp6(5),e.Oqu(o.l("CreateNewMassNotification")),e.xp6(1),e.Q6J("disabled",o.saving),e.xp6(4),e.Oqu(o.l("User")),e.xp6(2),e.Q6J("ngModel",o.userNames),e.xp6(3),e.hij(" ",o.l("Pick")," "),e.xp6(5),e.Oqu(o.l("OrganizationUnit")),e.xp6(2),e.Q6J("ngModel",o.organizationUnitDisplayNames),e.xp6(3),e.hij(" ",o.l("Pick")," "),e.xp6(5),e.Oqu(o.l("Severity")),e.xp6(1),e.Q6J("ngModel",o.createMassNotificationInput.severity),e.xp6(3),e.Oqu(o.l("Info")),e.xp6(2),e.Oqu(o.l("Success")),e.xp6(2),e.Oqu(o.l("Warn")),e.xp6(2),e.Oqu(o.l("Error")),e.xp6(2),e.Oqu(o.l("Fatal")),e.xp6(1),e.Q6J("formCtrl",i),e.xp6(3),e.hij(" ",o.l("TargetNotifiers"),"* "),e.xp6(1),e.Q6J("ngModel",o.createMassNotificationInput.targetNotifiers),e.xp6(3),e.Q6J("ngForOf",o.notifiers),e.xp6(1),e.Q6J("ngIf",o.showSMSTargetNotifierMessage),e.xp6(3),e.Oqu(o.l("Message")),e.xp6(1),e.Q6J("ngModel",o.createMassNotificationInput.message),e.xp6(2),e.Q6J("formCtrl",a),e.xp6(2),e.Q6J("disabled",o.saving),e.xp6(1),e.hij(" ",o.l("Cancel")," "),e.xp6(1),e.Q6J("disabled",!t.form.valid)("buttonBusy",o.saving)("busyText",o.l("SavingWithThreeDot")),e.xp6(3),e.Oqu(o.l("Save"))}}let ne=(()=>{class n extends b.c{constructor(t,i){super(t),this._notificationServiceProxy=i,this.modalSave=new e.vpe,this.active=!1,this.saving=!1,this.createMassNotificationInput=new m.hgY,this.userNames="",this.organizationUnitDisplayNames=""}show(){this.createMassNotificationInput=new m.hgY,this.active=!0,this._notificationServiceProxy.getAllNotifiers().subscribe(t=>{this.notifiers=t}),this.modal.show()}save(){this.createMassNotificationInput.message&&""!==this.createMassNotificationInput.message?this.createMassNotificationInput.targetNotifiers&&0!==this.createMassNotificationInput.targetNotifiers.length?this.createMassNotificationInput.userIds&&0!==this.createMassNotificationInput.userIds.length||this.createMassNotificationInput.organizationUnitIds&&0!==this.createMassNotificationInput.organizationUnitIds.length?(this.saving=!0,this._notificationServiceProxy.createMassNotification(this.createMassNotificationInput).pipe((0,w.x)(()=>{this.saving=!1})).subscribe(()=>{this.notify.info(this.l("SavedSuccessfully")),this.close(),this.modalSave.emit(null)})):abp.message.error(this.l("MassNotificationUserOrOrganizationUnitFieldIsRequiredMessage")):abp.message.error(this.l("MassNotificationTargetNotifiersFieldIsRequiredMessage")):abp.message.error(this.l("MassNotificationMessageFieldIsRequiredMessage"))}openSelectUserModal(){this.userLookupTableModalComponent.show()}openSelectOrganizationUnitModal(){this.organizationUnitLookupTableModalComponent.show()}setUserIdNull(){this.createMassNotificationInput.userIds=[],this.userNames=""}setOrganizationUnitIdNull(){this.createMassNotificationInput.organizationUnitIds=[],this.organizationUnitDisplayNames=""}onUsersSelected(t){this.createMassNotificationInput.userIds=t.map(i=>i.id),this.userNames="[ "+t.length+" "+this.l("ItemsSelected")+"] "+t.map(i=>i.displayName).join(", ")}onOrganizationUnitsSelected(t){this.createMassNotificationInput.organizationUnitIds=t.map(i=>i.id),this.organizationUnitDisplayNames="[ "+t.length+" "+this.l("ItemsSelected")+"] "+t.map(i=>i.displayName).join(", ")}close(){this.active=!1,this.modal.hide()}onTargetNotifiersChanged(){this.showSMSTargetNotifierMessage=this.createMassNotificationInput.targetNotifiers.includes("Minimates.Notifications.SmsRealTimeNotifier")}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(e.zs3),e.Y36(m.IMf))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["create-mass-notification-modal"]],viewQuery:function(i,a){if(1&i&&(e.Gf(V,7),e.Gf(ee,7),e.Gf(te,7)),2&i){let o;e.iGM(o=e.CRH())&&(a.modal=o.first),e.iGM(o=e.CRH())&&(a.userLookupTableModalComponent=o.first),e.iGM(o=e.CRH())&&(a.organizationUnitLookupTableModalComponent=o.first)}},outputs:{modalSave:"modalSave"},features:[e.qOj],decls:9,vars:1,consts:[["appBsModal","","tabindex","-1","role","dialog","aria-labelledby","createOrEditModal","aria-hidden","true",1,"modal","fade"],["createOrEditModal","bs-modal"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],["novalidate","","autocomplete","off",3,"ngSubmit",4,"ngIf"],[3,"modalSave"],["userLookupTableModalComponent",""],["organizationUnitLookupTableModalComponent",""],["novalidate","","autocomplete","off",3,"ngSubmit"],["notificationNewForm","ngForm"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"disabled","click"],[1,"modal-body"],[1,"my-3"],["for","UserName",1,"form-label"],[1,"input-group"],["id","UserName","name","userName","type","text","disabled","",1,"form-control",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-primary","blue",3,"click"],[1,"fa","fa-search"],["type","button",1,"btn","btn-danger","btn-icon",3,"click"],[1,"fa","fa-times"],["for","OrganizationUnitDisplayName",1,"form-label"],["id","OrganizationUnitDisplayName","name","organizationUnitDisplayName","type","text","disabled","",1,"form-control",3,"ngModel","ngModelChange"],["for","MassNotification_Severity",1,"form-label","required"],["required","","name","Severity","id","MassNotification_Severity",1,"form-select",3,"ngModel","ngModelChange"],["MassNotification_Severity","ngModel"],["value","0"],["value","1"],["value","2"],["value","3"],["value","4"],[3,"formCtrl"],["for","MassNotification_TargetNotifiers",1,"form-label"],["name","Severity","multiple","multiple","id","MassNotification_Severity",1,"form-select",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["class","form-text text-muted",4,"ngIf"],["for","MassNotification_Message",1,"form-label","required"],["required","","type","text","id","MassNotification_Message","name","Message",1,"form-control",3,"ngModel","ngModelChange"],["MassNotification_Message","ngModel"],[1,"modal-footer"],["type","button",1,"btn","btn-default",3,"disabled","click"],["type","submit",1,"btn","btn-primary","blue",3,"disabled","buttonBusy","busyText"],[1,"fa","fa-save"],[3,"value"],[1,"form-text","text-muted"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0,1)(2,"div",2)(3,"div",3),e.YNc(4,oe,65,29,"form",4),e.qZA()()(),e.TgZ(5,"user-lookup-table-modal",5,6),e.NdJ("modalSave",function(c){return a.onUsersSelected(c)}),e.qZA(),e.TgZ(7,"organization-unit-lookup-table-modal",5,7),e.NdJ("modalSave",function(c){return a.onOrganizationUnitsSelected(c)}),e.qZA()),2&i&&(e.xp6(4),e.Q6J("ngIf",a.active))},dependencies:[M.sg,M.O5,d._Y,d.YN,d.Kr,d.Fj,d.EJ,d.K7,d.JJ,d.JL,d.Q7,d.On,d.F,l.L,r.s,g.Z,G,X,p.F],encapsulation:2})}return n})();var se=s(88922);const le=["createMassNotificationModalComponent"],re=["messageDetailModal"],ce=["dataTable"],de=["paginator"];function pe(n,u){if(1&n){const t=e.EpF();e.TgZ(0,"button",31),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.createMassNotification())}),e._UZ(1,"i",32),e._uU(2),e.qZA()}if(2&n){const t=e.oxw();e.xp6(2),e.hij(" ",t.l("CreateNewMassNotification")," ")}}function ge(n,u){if(1&n&&(e.TgZ(0,"tr")(1,"th",33),e._uU(2),e.qZA(),e.TgZ(3,"th",34),e._uU(4),e.qZA(),e.TgZ(5,"th",35),e._uU(6),e.qZA(),e.TgZ(7,"th",34),e._uU(8),e.qZA()()),2&n){const t=e.oxw();e.xp6(2),e.hij(" ",t.l("Message")," "),e.xp6(2),e.hij(" ",t.l("Severity")," "),e.xp6(2),e.hij(" ",t.l("LastModificationTime")," "),e.xp6(2),e.hij(" ",t.l("IsPublished")," ")}}function ue(n,u){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit,i=e.oxw();e.xp6(1),e.hij(" ",i.getMessageDataString(t.data)," ")}}function me(n,u){if(1&n){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().$implicit,o=e.oxw();return e.KtG(o.showMessageDetailModal(a.data))}),e._uU(1),e.ALo(2,"localize"),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"ShowHTMLData")," "))}function fe(n,u){if(1&n){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().$implicit,o=e.oxw();return e.KtG(o.showMessageDetailModal(a.data))}),e._uU(1),e.ALo(2,"localize"),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"ShowData")," "))}function _e(n,u){1&n&&(e.TgZ(0,"span",42),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"Yes")," "))}function he(n,u){1&n&&(e.TgZ(0,"span",43),e._uU(1),e.ALo(2,"localize"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"No")," "))}function be(n,u){if(1&n&&(e.TgZ(0,"tr")(1,"td",33)(2,"span",36),e._uU(3),e.qZA(),e.YNc(4,ue,2,1,"span",37),e.YNc(5,me,3,3,"button",38),e.YNc(6,fe,3,3,"button",38),e.qZA(),e.TgZ(7,"td",34)(8,"span",36),e._uU(9),e.qZA(),e.TgZ(10,"span"),e._uU(11),e.qZA()(),e.TgZ(12,"td",35)(13,"span",36),e._uU(14),e.qZA(),e._uU(15),e.ALo(16,"luxonFormat"),e.qZA(),e.TgZ(17,"td",34)(18,"span",36),e._uU(19),e.qZA(),e.YNc(20,_e,3,3,"span",39),e.YNc(21,he,3,3,"span",40),e.qZA()()),2&n){const t=u.$implicit,i=e.oxw();e.xp6(3),e.Oqu(i.l("Name")),e.xp6(1),e.Q6J("ngIf",!i.isHTMLMessage(t.data)),e.xp6(1),e.Q6J("ngIf",i.shouldAddMessageDetailButton(t.data)&&i.isHTMLMessage(t.data)),e.xp6(1),e.Q6J("ngIf",i.shouldAddMessageDetailButton(t.data)&&!i.isHTMLMessage(t.data)),e.xp6(3),e.Oqu(i.l("Severity")),e.xp6(1),e.Tol(i.getSeverityClass(t.severity)),e.xp6(1),e.hij(" ",i.l(i.notificationSeverity[t.severity])," "),e.xp6(3),e.Oqu(i.l("LastModificationTime")),e.xp6(1),e.hij(" ",e.xi3(16,13,t.creationTime,"F")," "),e.xp6(4),e.Oqu(i.l("IsPublished")),e.xp6(1),e.Q6J("ngIf",t.isPublished),e.xp6(1),e.Q6J("ngIf",!t.isPublished)}}function Me(n,u){if(1&n&&(e.TgZ(0,"div",44),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" ",t.l("NoData")," ")}}const Te=function(){return{"min-width":"50rem"}},ve=[{path:"",component:(()=>{class n extends b.c{constructor(t,i,a){super(t),this._notificationServiceProxy=i,this._dateTimeService=a,this.dateRange=[this._dateTimeService.getStartOfDayMinusDays(7),this._dateTimeService.getEndOfDay()],this.notificationSeverity=m.qf6,this.messageMaxLength=50}getPublishedNotifications(t){this.primengTableHelper.shouldResetPaging(t)&&(this.paginator.changePage(0),this.primengTableHelper.records&&this.primengTableHelper.records.length>0)||(this.primengTableHelper.showLoadingIndicator(),this._notificationServiceProxy.getNotificationsPublishedByUser(this._dateTimeService.getStartOfDayForDate(this.dateRange[0]),this._dateTimeService.getEndOfDayForDate(this.dateRange[1])).subscribe(i=>{this.primengTableHelper.totalRecordsCount=i.totalCount,this.primengTableHelper.records=i.items,this.primengTableHelper.hideLoadingIndicator()}))}reloadPage(){this.paginator.changePage(this.paginator.getPage())}createMassNotification(){this.createMassNotificationModalComponent.show()}getMessageData(t){return JSON.parse(t).Properties.Message}isHTMLMessage(t){var i=this.getMessageData(t);let a=(new DOMParser).parseFromString(i,"text/html");return[].slice.call(a.body.childNodes).some(o=>1===o.nodeType)}getMessageDataString(t){var i=this.getMessageData(t);return i.length<=this.messageMaxLength?i:i.substring(0,this.messageMaxLength)+"..."}shouldAddMessageDetailButton(t){return this.getMessageData(t).length>this.messageMaxLength}showMessageDetailModal(t){var i=this.getMessageData(t);this.messageDetailString=i,this.messageDetailModal.show()}closeMessageDetailModal(){this.messageDetailModal.hide()}getSeverityClass(t){return t==m.qf6.Warn?"badge badge-warning":t==m.qf6.Success?"badge badge-success":t==m.qf6.Error||t==m.qf6.Fatal?"badge badge-danger":"badge badge-info"}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(e.zs3),e.Y36(m.IMf),e.Y36(O.C))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(i,a){if(1&i&&(e.Gf(le,7),e.Gf(re,7),e.Gf(ce,7),e.Gf(de,7)),2&i){let o;e.iGM(o=e.CRH())&&(a.createMassNotificationModalComponent=o.first),e.iGM(o=e.CRH())&&(a.messageDetailModal=o.first),e.iGM(o=e.CRH())&&(a.dataTable=o.first),e.iGM(o=e.CRH())&&(a.paginator=o.first)}},features:[e.qOj],decls:40,vars:32,consts:[[3,"title"],["role","actions"],["class","btn btn-secondary",3,"click",4,"ngIf"],[1,"btn","btn-primary","blue",3,"click"],[1,"la","la-refresh"],[1,"card","card-custom","gutter-b"],[1,"card-body"],["autocomplete","off",1,"form","mb-10"],[1,"row","align-items-center"],[1,"col-xl-12"],["id","StartEndRange","name","StartEndRange","readonly","readonly","bsDaterangepicker","","dateRangePickerLuxonModifier","",1,"form-control",3,"date","dateChange"],["drp","bsDaterangepicker"],[1,"primeng-datatable-container",3,"busyIf"],["ScrollWidth","100%",3,"value","rows","paginator","lazy","scrollable","tableStyle","resizableColumns","onLazyLoad"],["dataTable",""],["pTemplate","header"],["pTemplate","body"],["class","primeng-no-data",4,"ngIf"],[1,"primeng-paging-container"],[3,"rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","currentPageReportTemplate","onPageChange"],["paginator",""],[3,"modalSave"],["createMassNotificationModalComponent",""],["bsModal","","tabindex","-1","role","dialog","aria-labelledby","messageDetailModal","aria-hidden","true",1,"modal","fade"],["messageDetailModal","bs-modal"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body",3,"innerHTML"],[1,"btn","btn-secondary",3,"click"],[1,"fa","fa-plus"],[2,"min-width","250px"],[2,"max-width","150px"],[2,"max-width","250px"],[1,"p-column-title"],[4,"ngIf"],["class","btn btn-secondary btn-sm",3,"click",4,"ngIf"],["class","badge badge-success",4,"ngIf"],["class","badge badge-dark",4,"ngIf"],[1,"btn","btn-secondary","btn-sm",3,"click"],[1,"badge","badge-success"],[1,"badge","badge-dark"],[1,"primeng-no-data"]],template:function(i,a){1&i&&(e.TgZ(0,"div")(1,"sub-header",0),e.ALo(2,"localize"),e.TgZ(3,"div",1),e.YNc(4,pe,3,1,"button",2),e.TgZ(5,"button",3),e.NdJ("click",function(){return a.getPublishedNotifications()}),e._UZ(6,"i",4),e._uU(7),e.qZA()()(),e.TgZ(8,"div")(9,"div",5)(10,"div",6)(11,"form",7)(12,"div")(13,"div",8)(14,"div",9)(15,"input",10,11),e.NdJ("dateChange",function(c){return a.dateRange=c}),e.qZA()()()()(),e.TgZ(17,"div",8)(18,"div",12)(19,"p-table",13,14),e.NdJ("onLazyLoad",function(c){return a.getPublishedNotifications(c)}),e.YNc(21,ge,9,4,"ng-template",15),e.YNc(22,be,22,16,"ng-template",16),e.qZA(),e.YNc(23,Me,2,1,"div",17),e.TgZ(24,"div",18)(25,"p-paginator",19,20),e.NdJ("onPageChange",function(c){return a.getPublishedNotifications(c)}),e.ALo(27,"localize"),e.qZA()()()()()()()(),e.TgZ(28,"create-mass-notification-modal",21,22),e.NdJ("modalSave",function(){return a.getPublishedNotifications()}),e.qZA(),e.TgZ(30,"div",23,24)(32,"div",25)(33,"div",26)(34,"div",27)(35,"h4",28),e._uU(36),e.ALo(37,"localize"),e.qZA(),e.TgZ(38,"button",29),e.NdJ("click",function(){return a.closeMessageDetailModal()}),e.qZA()(),e._UZ(39,"div",30),e.qZA()()()),2&i&&(e.Q6J("@routerTransition",void 0),e.xp6(1),e.Q6J("title",e.lcZ(2,24,"MassNotifications")),e.xp6(3),e.Q6J("ngIf",a.isGranted("Pages.Administration.MassNotification")),e.xp6(3),e.hij(" ",a.l("Refresh")," "),e.xp6(1),e.Tol(a.containerClass),e.xp6(7),e.Q6J("date",a.dateRange),e.xp6(3),e.Q6J("busyIf",a.primengTableHelper.isLoading),e.xp6(1),e.s9C("rows",a.primengTableHelper.defaultRecordsCountPerPage),e.Q6J("value",a.primengTableHelper.records)("paginator",!1)("lazy",!0)("scrollable",!0)("tableStyle",e.DdM(31,Te))("resizableColumns",a.primengTableHelper.resizableColumns),e.xp6(4),e.Q6J("ngIf",0==a.primengTableHelper.totalRecordsCount),e.xp6(2),e.Q6J("rows",a.primengTableHelper.defaultRecordsCountPerPage)("totalRecords",a.primengTableHelper.totalRecordsCount)("rowsPerPageOptions",a.primengTableHelper.predefinedRecordsCountPerPage)("showCurrentPageReport",!0)("currentPageReportTemplate",e.xi3(27,26,"TotalRecordsCount",a.primengTableHelper.totalRecordsCount)),e.xp6(11),e.hij(" ",e.lcZ(37,29,"Message")," "),e.xp6(2),e.uIk("aria-label",a.l("Close")),e.xp6(1),e.Q6J("innerHTML",a.messageDetailString,e.oJD))},dependencies:[M.O5,d._Y,d.JL,d.F,J.oB,C.FR,C.TB,N.U,L.t,_.iA,Z.jx,U.D,k.$,ne,se.n,p.F],encapsulation:2,data:{animation:[(0,A.MH)()]}})}return n})(),pathMatch:"full"}];let Ce=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=e.oAB({type:n});static#a=this.\u0275inj=e.cJS({imports:[v.Bz.forChild(ve),v.Bz]})}return n})(),Ne=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=e.oAB({type:n});static#a=this.\u0275inj=e.cJS({imports:[z.o,S.g,Ce]})}return n})()},43136:(q,T,s)=>{s.d(T,{Z:()=>w});var S=s(94138),z=s(45920);var m=s(14818);const M=function O(l,r){return r.length<2?l:(0,m.Z)(l,function A(l,r,g){var f=-1,p=l.length;r<0&&(r=-r>p?0:p+r),(g=g>p?p:g)<0&&(g+=p),p=r>g?0:g-r>>>0,r>>>=0;for(var h=Array(p);++f<p;)h[f]=l[f+r];return h}(r,0,-1))};var d=s(77801);const C=function J(l,r){return r=(0,z.Z)(r,l),null==(l=M(l,r))||delete l[(0,d.Z)(function v(l){var r=null==l?0:l.length;return r?l[r-1]:void 0}(r))]};var N=s(19229),_=Array.prototype.splice;const w=function k(l,r){var g=[];if(!l||!l.length)return g;var f=-1,p=[],h=l.length;for(r=(0,S.Z)(r,3);++f<h;){var x=l[f];r(x,f,l)&&(g.push(x),p.push(f))}return function Z(l,r){for(var g=l?r.length:0,f=g-1;g--;){var p=r[g];if(g==f||p!==h){var h=p;(0,N.Z)(p)?_.call(l,p,1):C(l,p)}}}(l,p),g}}}]);