"use strict";(self.webpackChunkabp_zero_template=self.webpackChunkabp_zero_template||[]).push([[78616],{78616:(j,d,o)=>{o.r(d),o.d(d,{MaintenanceModule:()=>I});var p=o(70916),b=o(47530),m=o(41840),r=o(44328);const _=function C(n){return function(c){return n?.[c]}}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});var x=o(14471),g=/[&<>"']/g,L=RegExp(g.source);var w=o(64716),e=o(99468),y=o(98547),u=o(96814),h=o(612),M=o(68989),W=o(3291),O=o(83410);function R(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.sendNewVersionAvailableNotification())}),e._uU(1),e.ALo(2,"localize"),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"SendNewVersionNotification")," "))}function S(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.clearAllCaches())}),e._UZ(1,"i",23),e._uU(2),e.ALo(3,"localize"),e.qZA()}2&n&&(e.xp6(2),e.hij(" ",e.lcZ(3,1,"ClearAll")," "))}function z(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"span"),e._uU(3),e.qZA(),e.TgZ(4,"button",24),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.clearCache(s.name))}),e._uU(5),e.ALo(6,"localize"),e.qZA()()()}if(2&n){const t=c.$implicit;e.xp6(3),e.Oqu(t.name),e.xp6(2),e.hij(" ",e.lcZ(6,2,"Clear")," ")}}function F(n,c){if(1&n&&(e.TgZ(0,"span",25)(1,"span"),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&n){const t=c.$implicit,i=e.oxw();e.xp6(1),e.Tol(i.getLogClass(t)),e.xp6(1),e.Oqu(i.getLogType(t)),e.xp6(1),e.hij(" ",i.getRawLogContent(t)," ")}}const H=[{path:"",component:(()=>{class n extends m.c{constructor(t,i,a,s,l){super(t),this._cacheService=i,this._webLogService=a,this._fileDownloadService=s,this._notificationService=l,this.loading=!1,this.caches=null,this.canClearAllCaches=!1,this.logs="",this.downloadWebLogs=function(){const f=this;f._webLogService.downloadWebLogs().subscribe(P=>{f._fileDownloadService.downloadTempFile(P)})}}sendNewVersionAvailableNotification(){abp.message.confirm(this.l("SendNewVersionNotificationWarningMessage"),null,t=>{t&&this._notificationService.createNewVersionReleasedNotification().subscribe(i=>{abp.notify.info(this.l("SuccessfullySentNewVersionNotification"))})})}getCaches(){const t=this;t.loading=!0,t._cacheService.getAllCaches().pipe((0,w.x)(()=>{t.loading=!1})).subscribe(i=>{t.caches=i.items})}clearCache(t){const i=this,a=new r.IRy;a.id=t,i._cacheService.clearCache(a).subscribe(()=>{i.notify.success(i.l("CacheSuccessfullyCleared"))})}clearAllCaches(){const t=this;t._cacheService.clearAllCaches().subscribe(()=>{t.notify.success(t.l("AllCachesSuccessfullyCleared"))})}getWebLogs(){const t=this;t._webLogService.getLatestWebLogs().subscribe(i=>{t.logs=i.latestWebLogLines,t.fixWebLogsPanelHeight()})}setCanClearAllCaches(){this._cacheService.canClearAllCaches().subscribe(t=>{this.canClearAllCaches=t})}getLogClass(t){return t.startsWith("DEBUG")?"badge badge-dark":t.startsWith("INFO")?"badge badge-info":t.startsWith("WARN")?"badge badge-warning":t.startsWith("ERROR")||t.startsWith("FATAL")?"badge badge-danger":""}getLogType(t){return t.startsWith("DEBUG")?"DEBUG":t.startsWith("INFO")?"INFO":t.startsWith("WARN")?"WARN":t.startsWith("ERROR")?"ERROR":t.startsWith("FATAL")?"FATAL":""}getRawLogContent(t){return function T(n){return(n=(0,x.Z)(n))&&L.test(n)?n.replace(g,_):n}(t).replace("DEBUG","").replace("INFO","").replace("WARN","").replace("ERROR","").replace("FATAL","")}fixWebLogsPanelHeight(){let t=document.getElementsByClassName("full-height")[0];const i=document.body.clientHeight,a=t.clientHeight;t.style.height=a+(i-a)-420+"px"}onResize(t){this.fixWebLogsPanelHeight()}ngOnInit(){const t=this;t.getCaches(),t.getWebLogs(),t.setCanClearAllCaches()}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(e.zs3),e.Y36(r.riO),e.Y36(r.jf7),e.Y36(y._),e.Y36(r.IMf))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],features:[e.qOj],decls:44,vars:30,consts:[[3,"resize"],[3,"title"],["role","actions"],["id","SendNewVersionNotification","class","btn btn-primary",3,"click",4,"ngIf"],[1,"card","card-custom","gutter-b"],[1,"card-body"],[3,"heading"],[1,"row","m-3"],[1,"col-xl-6"],[1,"mt-5"],[1,"col-xl-6","text-end"],["class","btn btn-primary float-end",3,"click",4,"ngIf"],[1,"col-xl-12"],[1,"table","table-striped","table-hover","table-bordered"],[4,"ngFor","ngForOf"],[1,"btn","btn-secondary","me-2",3,"click"],[1,"fa","fa-download"],[1,"btn","btn-primary",3,"click"],[1,"fa","fa-sync"],[1,"web-log-view","full-height"],["class","log-line",4,"ngFor","ngForOf"],["id","SendNewVersionNotification",1,"btn","btn-primary",3,"click"],[1,"btn","btn-primary","float-end",3,"click"],[1,"fa","fa-recycle"],[1,"btn","btn-primary","btn-sm","pull-right",3,"click"],[1,"log-line"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0),e.NdJ("resize",function(l){return a.onResize(l)},!1,e.Jf7),e.TgZ(1,"sub-header",1),e.ALo(2,"localize"),e.TgZ(3,"div",2),e.YNc(4,R,3,3,"button",3),e.ALo(5,"permission"),e.qZA()(),e.TgZ(6,"div")(7,"div",4)(8,"div",5)(9,"tabset")(10,"tab",6),e.ALo(11,"localize"),e.TgZ(12,"div",7)(13,"div",8)(14,"p",9),e._uU(15),e.ALo(16,"localize"),e.qZA()(),e.TgZ(17,"div",10),e.YNc(18,S,4,3,"button",11),e.qZA()(),e.TgZ(19,"div",7)(20,"div",12)(21,"table",13)(22,"tbody"),e.YNc(23,z,7,4,"tr",14),e.qZA()()()()(),e.TgZ(24,"tab",6),e.ALo(25,"localize"),e.TgZ(26,"div",7)(27,"div",8)(28,"p",9),e._uU(29),e.ALo(30,"localize"),e.qZA()(),e.TgZ(31,"div",10)(32,"button",15),e.NdJ("click",function(){return a.downloadWebLogs()}),e._UZ(33,"i",16),e._uU(34),e.ALo(35,"localize"),e.qZA(),e.TgZ(36,"button",17),e.NdJ("click",function(){return a.getWebLogs()}),e._UZ(37,"i",18),e._uU(38),e.ALo(39,"localize"),e.qZA()()(),e.TgZ(40,"div",7)(41,"div",12)(42,"div",19),e.YNc(43,F,4,4,"span",20),e.qZA()()()()()()()()()),2&i&&(e.Q6J("@routerTransition",void 0),e.xp6(1),e.Q6J("title",e.lcZ(2,14,"Maintenance")),e.xp6(3),e.Q6J("ngIf",e.lcZ(5,16,"Pages_Administration_NewVersion_Create")),e.xp6(2),e.Tol(a.containerClass),e.xp6(4),e.MGl("heading"," ",e.lcZ(11,18,"Caches"),""),e.xp6(5),e.Oqu(e.lcZ(16,20,"CachesHeaderInfo")),e.xp6(3),e.Q6J("ngIf",a.canClearAllCaches),e.xp6(5),e.Q6J("ngForOf",a.caches),e.xp6(1),e.s9C("heading",e.lcZ(25,22,"WebSiteLogs")),e.xp6(5),e.Oqu(e.lcZ(30,24,"WebSiteLogsHeaderInfo")),e.xp6(5),e.hij(" ",e.lcZ(35,26,"DownloadAll")," "),e.xp6(4),e.hij(" ",e.lcZ(39,28,"Refresh")," "),e.xp6(5),e.Q6J("ngForOf",a.logs))},dependencies:[u.sg,u.O5,h.wW,h.AH,M.$,W.F,O.a],styles:[".web-log-view[_ngcontent-%COMP%]{font-family:Courier New;overflow-x:scroll;overflow-y:scroll;height:100%;white-space:nowrap}.web-log-view[_ngcontent-%COMP%]   span.log-line[_ngcontent-%COMP%]{margin-bottom:5px;display:block}.web-log-view[_ngcontent-%COMP%]   span.log-line[_ngcontent-%COMP%]   span.label[_ngcontent-%COMP%]{width:50px;display:inline-block}"],data:{animation:[(0,b.MH)()]}})}return n})(),pathMatch:"full"}];let U=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=e.oAB({type:n});static#n=this.\u0275inj=e.cJS({imports:[p.Bz.forChild(H),p.Bz]})}return n})();var J=o(71902),E=o(92337);let I=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=e.oAB({type:n});static#n=this.\u0275inj=e.cJS({imports:[E.o,J.g,U]})}return n})()}}]);